---
title: "Untitled"
output: html_document
date: "2025-08-30"
---

## Início

Requisitando os pacotes necessários para execução do script:

```{r, echo=FALSE}
library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)
```
Aqui eu trato as tabelas para organizá-las:

```{r}
#diesel
diesel = readxl::read_xlsx("data/Prova_macro_Case 1 (1).xlsx", sheet = "diesel") %>%
  pivot_longer(
    cols = 3:ncol(.),
    names_to = "ano",
    values_to = "vendas_m3"
  ) %>%
mutate(combustivel = "diesel")
diesel = diesel %>% select(combustivel, regiao, meses, ano, vendas_m3)

#gasolina
gasolina = readxl::read_xlsx("data/Prova_macro_Case 1 (1).xlsx", sheet = "gasolina") %>%
  pivot_longer(
    cols = 3:ncol(.),
    names_to = "ano",
    values_to = "vendas_m3"
  ) %>%
mutate(combustivel = "gasolina")
gasolina = gasolina %>% select(combustivel, regiao, meses, ano, vendas_m3)

#etanol
etanol = readxl::read_xlsx("data/Prova_macro_Case 1 (1).xlsx", sheet = "etanol") %>%
  pivot_longer(
    cols = 3:ncol(.),
    names_to = "ano",
    values_to = "vendas_m3"
  ) %>%
mutate(combustivel = "etanol")
etanol = etanol %>% select(combustivel, regiao, meses, ano, vendas_m3)

# Jutando os três dataframes em um só
combustiveis = rbind(diesel, etanol, gasolina)
```

## Respostas

1)  Qual é a sazonalidade da venda de combustíveis?

```{r}
etapa1 = combustiveis %>%
  filter(regiao == "br") %>%
  group_by(meses, ano) %>%
  summarise(vendas = sum(vendas_m3, na.rm = TRUE), .groups = "drop")
etapa1 = etapa1 %>% filter(vendas != 0)

etapa1 = etapa1 %>% mutate(data = as.Date(paste(ano, meses, "01", sep = "-")))
etapa1 = etapa1 %>% select(data, vendas)

# Escolha o recorte de interesse
recorte_data = etapa1 %>% filter(data > "2000-01-01" & data < "2005-01-01")

ggplot(recorte_data, aes(x = data, y = vendas)) +
  geom_line(color = "black") +
  scale_x_date(
    date_labels = "%b %Y",
    date_breaks = "6 months"
  ) +
  scale_y_continuous(labels = scales::comma) +
  labs(
  title = "Vendas de Combustíveis por mês no Brasil",
  x = "Mês/Ano",
  y = "Vendas (m³)"
)
print("O último trimestre costuma ter forte queda nas vendas. O final do primeiro trimestre é de recuperação, enquanto o segundo e o terceiro trimestres costumam ser os picos de vendas.")
```

2)  Essa sazonalidade é igual em todos os estados?

```{r}
etapa1 = combustiveis %>%
  filter(regiao == "ma") %>%
  group_by(meses, ano) %>%
  summarise(vendas = sum(vendas_m3, na.rm = TRUE), .groups = "drop")
etapa1 = etapa1 %>% filter(vendas != 0)

etapa1 = etapa1 %>% mutate(data = as.Date(paste(ano, meses, "01", sep = "-")))
etapa1 = etapa1 %>% select(data, vendas)

# Escolha o recorte de interesse
recorte_data = etapa1 %>% filter(data > "2000-01-01" & data < "2005-01-01")

ggplot(recorte_data, aes(x = data, y = vendas)) +
  geom_line(color = "black") +
  scale_x_date(
    date_labels = "%b %Y",
    date_breaks = "6 months"
  ) +
  scale_y_continuous(labels = scales::comma) +
  labs(
  title = "Vendas de Combustíveis por mês no Brasil",
  x = "Mês/Ano",
  y = "Vendas (m³)"
  )

print("Sim, a sazonalidade é a mesma em todos os estados")
```

3)  Como o consumo de cada tipo de combustível está distribuído entre os estados brasileiros?

```{r}
vendas_2020 = combustiveis %>%
  filter(ano == 2020 & combustivel == "diesel") %>%
  group_by(regiao) %>%
  summarise(vendas_total = sum(vendas_m3, na.rm = TRUE))

br = vendas_2020[[1,2]]
df = vendas_2020[[2,2]]
go = vendas_2020[[3,2]]
ma = vendas_2020[[4,2]]
mg = vendas_2020[[5,2]]
mt = vendas_2020[[6,2]]
pa = vendas_2020[[7,2]]
sp = vendas_2020[[8,2]]
to = vendas_2020[[9,2]]

part_df = round(((df/br) * 100), 2)
part_go = round(((go/br) * 100), 2)
part_ma = round(((ma/br) * 100), 2)
part_mg = round(((mg/br) * 100), 2)
part_mt = round(((mt/br) * 100), 2)
part_pa = round(((pa/br) * 100), 2)
part_sp = round(((sp/br) * 100), 2)
part_to = round(((to/br) * 100), 2)

print(paste("A participação das vendas de diesel no DF em relação ao Brasil é de", part_df, "%"))
print(paste("A participação das vendas de diesel no MA em relação ao Brasil é de", part_ma, "%"))
print(paste("A participação das vendas de diesel em MT em relação ao Brasil é de", part_mt, "%"))
print(paste("A participação das vendas de diesel em MG em relação ao Brasil é de", part_mg, "%"))
print(paste("A participação das vendas de diesel no PA em relação ao Brasil é de", part_pa, "%"))
print(paste("A participação das vendas de diesel em SP em relação ao Brasil é de", part_sp, "%"))
print(paste("A participação das vendas de diesel em TO em relação ao Brasil é de", part_to, "%"))
print(paste("A participação das vendas de diesel em GO em relação ao Brasil é de", part_go, "%"))

vendas_2020 = combustiveis %>%
  filter(ano == 2020 & combustivel == "gasolina") %>%
  group_by(regiao) %>%
  summarise(vendas_total = sum(vendas_m3, na.rm = TRUE))

br = vendas_2020[[1,2]]
df = vendas_2020[[2,2]]
go = vendas_2020[[3,2]]
ma = vendas_2020[[4,2]]
mg = vendas_2020[[5,2]]
mt = vendas_2020[[6,2]]
pa = vendas_2020[[7,2]]
sp = vendas_2020[[8,2]]
to = vendas_2020[[9,2]]

part_df = round(((df/br) * 100), 2)
part_go = round(((go/br) * 100), 2)
part_ma = round(((ma/br) * 100), 2)
part_mg = round(((mg/br) * 100), 2)
part_mt = round(((mt/br) * 100), 2)
part_pa = round(((pa/br) * 100), 2)
part_sp = round(((sp/br) * 100), 2)
part_to = round(((to/br) * 100), 2)

print(paste("A participação das vendas de gasolina no DF em relação ao Brasil é de", part_df, "%"))
print(paste("A participação das vendas de gasolina no MA em relação ao Brasil é de", part_ma, "%"))
print(paste("A participação das vendas de gasolina em MT em relação ao Brasil é de", part_mt, "%"))
print(paste("A participação das vendas de gasolina em MG em relação ao Brasil é de", part_mg, "%"))
print(paste("A participação das vendas de gasolina no PA em relação ao Brasil é de", part_pa, "%"))
print(paste("A participação das vendas de gasolina em SP em relação ao Brasil é de", part_sp, "%"))
print(paste("A participação das vendas de gasolina em TO em relação ao Brasil é de", part_to, "%"))
print(paste("A participação das vendas de gasolina em GO em relação ao Brasil é de", part_go, "%"))

vendas_2020 = combustiveis %>%
  filter(ano == 2020 & combustivel == "etanol") %>%
  group_by(regiao) %>%
  summarise(vendas_total = sum(vendas_m3, na.rm = TRUE))

br = vendas_2020[[1,2]]
df = vendas_2020[[2,2]]
go = vendas_2020[[3,2]]
ma = vendas_2020[[4,2]]
mg = vendas_2020[[5,2]]
mt = vendas_2020[[6,2]]
pa = vendas_2020[[7,2]]
sp = vendas_2020[[8,2]]
to = vendas_2020[[9,2]]

part_df = round(((df/br) * 100), 2)
part_go = round(((go/br) * 100), 2)
part_ma = round(((ma/br) * 100), 2)
part_mg = round(((mg/br) * 100), 2)
part_mt = round(((mt/br) * 100), 2)
part_pa = round(((pa/br) * 100), 2)
part_sp = round(((sp/br) * 100), 2)
part_to = round(((to/br) * 100), 2)

print(paste("A participação das vendas de etanol no DF em relação ao Brasil é de", part_df, "%"))
print(paste("A participação das vendas de etanol no MA em relação ao Brasil é de", part_ma, "%"))
print(paste("A participação das vendas de etanol em MT em relação ao Brasil é de", part_mt, "%"))
print(paste("A participação das vendas de etanol em MG em relação ao Brasil é de", part_mg, "%"))
print(paste("A participação das vendas de etanol no PA em relação ao Brasil é de", part_pa, "%"))
print(paste("A participação das vendas de etanol em SP em relação ao Brasil é de", part_sp, "%"))
print(paste("A participação das vendas de etanol em TO em relação ao Brasil é de", part_to, "%"))
print(paste("A participação das vendas de etanol em GO em relação ao Brasil é de", part_go, "%"))
```

4) Qual é o tamanho total do mercado e como ele evoluiu durante os últimos 5 anos?

```{r, echo=FALSE}
vendas_2015 = combustiveis %>%
  filter(ano == 2015 & regiao == "br") %>%
  group_by(regiao) %>%
  summarise(vendas_total = sum(vendas_m3, na.rm = TRUE))

vendas_2016 = combustiveis %>%
  filter(ano == 2016 & regiao == "br") %>%
  group_by(regiao) %>%
  summarise(vendas_total = sum(vendas_m3, na.rm = TRUE))

vendas_2017 = combustiveis %>%
  filter(ano == 2017 & regiao == "br") %>%
  group_by(regiao) %>%
  summarise(vendas_total = sum(vendas_m3, na.rm = TRUE))

vendas_2018 = combustiveis %>%
  filter(ano == 2018 & regiao == "br") %>%
  group_by(regiao) %>%
  summarise(vendas_total = sum(vendas_m3, na.rm = TRUE))

vendas_2019 = combustiveis %>%
  filter(ano == 2019 & regiao == "br") %>%
  group_by(regiao) %>%
  summarise(vendas_total = sum(vendas_m3, na.rm = TRUE))

vendas_2020 = combustiveis %>%
  filter(ano == 2020 & regiao == "br") %>%
  group_by(regiao) %>%
  summarise(vendas_total = sum(vendas_m3, na.rm = TRUE))

vendas_2015 = vendas_2015[[1,2]]
vendas_2016 = vendas_2016[[1,2]]
vendas_2017 = vendas_2017[[1,2]]
vendas_2018 = vendas_2018[[1,2]]
vendas_2019 = vendas_2019[[1,2]]
vendas_2020 = vendas_2020[[1,2]]

tx_2016 = (vendas_2016/vendas_2015) - 1
tx_2017 = (vendas_2017/vendas_2016) - 1
tx_2018 = (vendas_2018/vendas_2017) - 1
tx_2019 = (vendas_2019/vendas_2018) - 1
tx_2020 = (vendas_2020/vendas_2019) - 1

tx_média_5_anos = round(mean(tx_2016, tx_2017, tx_2018, tx_2019, tx_2020), 2)
print(paste("O tamanho do mercado em 2020 foi de", vendas_2020, "m³ vendidos em 2020"))
print(paste("A taxa de crescimento do mercado nos últimos 5 anos foi de", tx_média_5_anos, "% ao ano, praticamente estável"))
```
